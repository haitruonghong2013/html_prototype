<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Make Schedule</title>

    <meta name="description" content="Static &amp; Dynamic Tables"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <!--basic styles-->

    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="assets/css/bootstrap-responsive.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="assets/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="assets/css/application.css"/>

    <!--[if IE 7]>
    <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css"/>
    <![endif]-->

    <!--page specific plugin styles-->
    <link rel="stylesheet" href="assets/css/jquery-ui-1.10.3.custom.min.css" />
    <link rel="stylesheet" href="assets/css/chosen.css" />
    <link rel="stylesheet" href="assets/css/datepicker.css" />
    <link rel="stylesheet" href="assets/css/bootstrap-timepicker.css" />
    <link rel="stylesheet" href="assets/css/daterangepicker.css" />
    <link rel="stylesheet" href="assets/css/colorpicker.css" />
    <link rel="stylesheet" href="assets/css/schedules.css" />

    <!--fonts-->

    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,300"/>

    <!--ace styles-->

    <link rel="stylesheet" href="assets/css/ace.min.css"/>
    <link rel="stylesheet" href="assets/css/ace-responsive.min.css"/>
    <link rel="stylesheet" href="assets/css/ace-skins.min.css"/>

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="assets/css/ace-ie.min.css"/>
    <![endif]-->

    <!--inline styles related to this page-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyC7icpVNHCpzkJjilXkACn8VG9HlSe0u3s&sensor=false"></script>
    <script>

    var directionsDisplay;
    var directionsService = new google.maps.DirectionsService();
    var mapCanvas;

    //    //change polyline color
    //    var polylineOptionsActual = new google.maps.Polyline({
    //        strokeColor: '#3C00FF',
    //        strokeOpacity: 0.5,
    //        strokeWeight: 3
    //    });

    //Fix bug change color of polylineOptionActual
    //    olyOptionsActual and polyOptionsPlan should be polylineOptions
    //    anonymous objects, not Polylines.
    //
    //            Javascript Object properties are case sensitive:
    //            so not:
    //            strokecolor: '#FF0000',
    //                    strokeopacity: 1.0,
    //            strokeweight: 10
    //    use:
    //            strokeColor: '#FF0000',
    //                    strokeOpacity: 1.0,
    //            strokeWeight: 10
    var polylineOptionsActual = {
        strokeColor: '#3C00FF',
        strokeOpacity: 0.5,
        strokeWeight: 3
    };

    var rendererOptions = {
        polylineOptions:polylineOptionsActual,
        suppressMarkers : true
    }

    var clientObjects = [];
    var clientListAddress = [];

    var stepDisplay;
    var markerArray = [];

    function initialize() {

        directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);

        // Instantiate an info window to hold step text.
        stepDisplay = new google.maps.InfoWindow();

        var latlng = new google.maps.LatLng(21.0333333, 105.85000000000002);
        var mapOptions = {
            zoom: 13,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            center: latlng
        }
        mapCanvas = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        directionsDisplay.setMap(mapCanvas);
    }

    function addHiddenControls(waypoints_order, timeMeetingsArray){
        for(var i=0;i<waypoints_order.length;i++){
            $('#clientaddressdiv').append('<input name="meeting['+i+'][id]" type="hidden" value="'+clientListAddress[waypoints_order[i]]["id"]+'"/>');
            $('#clientaddressdiv').append('<input name="meeting['+i+'][address]" type="hidden" value="'+clientListAddress[waypoints_order[i]]['location']["address"]+'"/>');
            $('#clientaddressdiv').append('<input name="meeting['+i+'][meeting_duration]" type="hidden" value="'+$('#schedule_average_meeting_duration').val()+'"/>');
            $('#clientaddressdiv').append('<input name="meeting['+i+'][meeting_time]" type="hidden" value="'+timeMeetingsArray[i].meetingTime+'"/>');
        }
    }

    function calcRoute() {

        // First, remove any existing markers from the map.
        for (i = 0; i < markerArray.length; i++) {
            markerArray[i].setMap(null);
        }

        // Now, clear the array itself.
        markerArray = [];

        var start = document.getElementById('schedule_hq_location_id').value;
        var end = document.getElementById('schedule_ending_location_id').value;

//        var start = 'Ha Noi, Viet Nam';
//        var end = 'Ho Chi Minh, Viet Nam';
        var waypts = [];
//        var checkboxArray = document.getElementById('waypoints');
//        for (var i = 0; i < checkboxArray.length; i++) {
//            if (checkboxArray.options[i].selected == true) {
//                waypts.push({
//                    location:checkboxArray[i].value,
//                    stopover:true});
//            }
//        }

        for (var i = 0; i < clientListAddress.length; i++) {
            waypts.push({
                location:clientListAddress[i]['location']['address'],
                stopover:true});
        }

        var request = {
            origin: start,
            destination: end,
            waypoints: waypts,
            optimizeWaypoints: true,
            travelMode: google.maps.TravelMode.DRIVING
        };
        directionsService.route(request, function(response, status) {
            if (status == google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(response);
                showSteps(response);
                var route = response.routes[0];
                var summaryPanel = document.getElementById('directions_panel');
                summaryPanel.innerHTML = '';
                // For each route, display summary information.
//                for (var i = 0; i < route.legs.length; i++) {
//                    var routeSegment = i + 1;
//                    summaryPanel.innerHTML += '<b>Route Segment: ' + routeSegment + '</b><br>';
//                    summaryPanel.innerHTML += route.legs[i].start_address + ' to ';
//                    summaryPanel.innerHTML += route.legs[i].end_address + '<br>';
//                    summaryPanel.innerHTML += route.legs[i].distance.text + '<br>';
//                    summaryPanel.innerHTML += route.legs[i].duration.text + '<br><br>';
//                }
//                summaryPanel.innerHTML += 'Waypoint order:'+route.waypoint_order+'<br>';
                var startTime = $('#schedule_start_time').val();
                var endTime = $('#schedule_end_time').val();
                alert("schedule_start_time : "+startTime);
//                addTime(startTime, 30);
                if (calculateDurationTime(route,diffBetweenTwoTimes(startTime,endTime))){

//                    calculateTimeAtClientMeeting(route,startTime,30);
                    addHiddenControls(route.waypoint_order, calculateTimeAtClientMeeting(route,startTime,30));
                }
                else{
                    alert("time to travel exeed working time, please try choosing another way!");
                }


            }
        });

    }


    function diffBetweenTwoTimes(startTime, endTime){
        var a = moment(startTime, "HH:mm:ss");
        var b = moment(endTime, "HH:mm:ss");
        return b.diff(a,'seconds');
    }

    function addTime(timeParam, minutes){
        var timeMoment = moment(timeParam, "HH:mm:ss");
        timeMoment.add('minutes',minutes);
//        alert(timeMoment.hour()+":"+timeMoment.minute()+":"+timeMoment.second());
        return timeMoment.hour()+":"+timeMoment.minute();
    }


    function convertSecondsToTime(raw){
//        var raw = "-54";
        var time = parseInt(raw,10);
        time = time < 0 ? 0 : time;

        var minutes = Math.floor(time / 60);
        var seconds = time % 60;

        minutes = minutes < 10 ? "0"+minutes : minutes;
        seconds = seconds < 10 ? "0"+seconds : seconds;

//        alert(minutes+":"+seconds);
        return minutes+":"+seconds
    }

    function calculateTimeAtClientMeeting(route, startTime,meetingDuration){
        var startAtApoint = startTime;
//        alert("startAtApoint : "+startAtApoint);
        var totalTime = 0;
        var timeMeetingsArray = [];
        var timeMeetingObj;
        for (var i = 0; i < route.legs.length; i++) {
            timeMeetingObj = new Object();
            totalTime += route.legs[i].duration.value;

            //set value to timeMeeting object
            // duration is seconds, so need convert to minutes
            timeMeetingObj.travelTime = route.legs[i].duration.value/60;
            timeMeetingObj.meetingTime = addTime(startAtApoint, timeMeetingObj.travelTime);
            alert("timeMeetingObj.travelTime :"+timeMeetingObj.travelTime+
                    "\n timeMeetingObj.meetingTime :"+timeMeetingObj.meetingTime);
            startAtApoint = addTime(startAtApoint, meetingDuration);
            timeMeetingsArray.push(timeMeetingObj);
        }

        return  timeMeetingsArray;

    }


    function calculateDurationTime(route, maxTotalTime){
        var totalTime = 0;

        for (var i = 0; i < route.legs.length; i++) {
            totalTime += route.legs[i].duration.value;
        }
//        alert(totalTime);
        if (totalTime/60 > maxTotalTime){
            return false;
        }
        else{
            return true;
        }

    }

    function showSteps(directionResult) {
        // For each step, place a marker, and add the text to the marker's
        // info window. Also attach the marker to an array so we
        // can keep track of it and remove it when calculating new
        // routes.
//        var myRoute = directionResult.routes[0].legs[0];
//
//        for (var i = 0; i < myRoute.steps.length; i++) {
//            var icon = "https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=" + i + "|FF0000|000000";
//            if (i == 0) {
//                icon = "https://chart.googleapis.com/chart?chst=d_map_xpin_icon&chld=pin_star|car-dealer|00FFFF|FF0000";
//            }
//            var marker = new google.maps.Marker({
//                position: myRoute.steps[i].start_point,
//                map: mapCanvas,
//                icon: icon
//            });
//            attachInstructionText(marker, myRoute.steps[i].instructions);
//            markerArray.push(marker);
//        }
//        var marker = new google.maps.Marker({
//            position: myRoute.steps[i - 1].end_point,
//            map: mapCanvas,
//            icon: "https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=flag|ADDE63"
//        });

        var myRoute = directionResult.routes[0];

        for (var i = 0; i < myRoute.legs.length; i++) {
            var icon = "https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=" + i + "|FF0000|000000";
            if (i == 0) {
                icon = "https://chart.googleapis.com/chart?chst=d_map_xpin_icon&chld=pin_star|car-dealer|00FFFF|FF0000";
            }
            var marker = new google.maps.Marker({
                position: myRoute.legs[i].start_location,
                map: mapCanvas,
                icon: icon
            });
            attachInstructionText(marker, myRoute.legs[i].start_address);
            markerArray.push(marker);
        }
        var marker = new google.maps.Marker({
            position: myRoute.legs[myRoute.legs.length - 1].end_location,
            map: mapCanvas,
            icon: "https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=flag|ADDE63"
        });
        markerArray.push(marker);

        google.maps.event.trigger(markerArray[0], "click");
    }

    function attachInstructionText(marker, text) {
        google.maps.event.addListener(marker, 'click', function() {
            // Open an info window when the marker is clicked on,
            // containing the text of the step.
            stepDisplay.setContent(text);
            stepDisplay.open(mapCanvas, marker);
        });
    }

    </script>
</head>

<body>
<div class="navbar">
<div class="navbar-inner">
<div class="container-fluid">
<a href="#" class="brand">
    <small>
        <i class="icon-leaf"></i>
        Ipad App
    </small>
</a><!--/.brand-->

<ul class="nav ace-nav pull-right">
<!--<li class="grey">-->
<!--<a data-toggle="dropdown" class="dropdown-toggle" href="#">-->
<!--<i class="icon-tasks"></i>-->
<!--<span class="badge badge-grey">4</span>-->
<!--</a>-->

<!--<ul class="pull-right dropdown-navbar dropdown-menu dropdown-caret dropdown-closer">-->
<!--<li class="nav-header">-->
<!--<i class="icon-ok"></i>-->
<!--4 Tasks to complete-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--<div class="clearfix">-->
<!--<span class="pull-left">Software Update</span>-->
<!--<span class="pull-right">65%</span>-->
<!--</div>-->

<!--<div class="progress progress-mini ">-->
<!--<div style="width:65%" class="bar"></div>-->
<!--</div>-->
<!--</a>-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--<div class="clearfix">-->
<!--<span class="pull-left">Hardware Upgrade</span>-->
<!--<span class="pull-right">35%</span>-->
<!--</div>-->

<!--<div class="progress progress-mini progress-danger">-->
<!--<div style="width:35%" class="bar"></div>-->
<!--</div>-->
<!--</a>-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--<div class="clearfix">-->
<!--<span class="pull-left">Unit Testing</span>-->
<!--<span class="pull-right">15%</span>-->
<!--</div>-->

<!--<div class="progress progress-mini progress-warning">-->
<!--<div style="width:15%" class="bar"></div>-->
<!--</div>-->
<!--</a>-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--<div class="clearfix">-->
<!--<span class="pull-left">Bug Fixes</span>-->
<!--<span class="pull-right">90%</span>-->
<!--</div>-->

<!--<div class="progress progress-mini progress-success progress-striped active">-->
<!--<div style="width:90%" class="bar"></div>-->
<!--</div>-->
<!--</a>-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--See tasks with details-->
<!--<i class="icon-arrow-right"></i>-->
<!--</a>-->
<!--</li>-->
<!--</ul>-->
<!--</li>-->

<!--<li class="purple">-->
<!--<a data-toggle="dropdown" class="dropdown-toggle" href="#">-->
<!--<i class="icon-bell-alt icon-animated-bell"></i>-->
<!--<span class="badge badge-important">8</span>-->
<!--</a>-->

<!--<ul class="pull-right dropdown-navbar navbar-pink dropdown-menu dropdown-caret dropdown-closer">-->
<!--<li class="nav-header">-->
<!--<i class="icon-warning-sign"></i>-->
<!--8 Notifications-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--<div class="clearfix">-->
<!--<span class="pull-left">-->
<!--<i class="btn btn-mini no-hover btn-pink icon-comment"></i>-->
<!--New Comments-->
<!--</span>-->
<!--<span class="pull-right badge badge-info">+12</span>-->
<!--</div>-->
<!--</a>-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--<i class="btn btn-mini btn-primary icon-user"></i>-->
<!--Bob just signed up as an editor ...-->
<!--</a>-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--<div class="clearfix">-->
<!--<span class="pull-left">-->
<!--<i class="btn btn-mini no-hover btn-success icon-shopping-cart"></i>-->
<!--New Orders-->
<!--</span>-->
<!--<span class="pull-right badge badge-success">+8</span>-->
<!--</div>-->
<!--</a>-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--<div class="clearfix">-->
<!--<span class="pull-left">-->
<!--<i class="btn btn-mini no-hover btn-info icon-twitter"></i>-->
<!--Followers-->
<!--</span>-->
<!--<span class="pull-right badge badge-info">+11</span>-->
<!--</div>-->
<!--</a>-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--See all notifications-->
<!--<i class="icon-arrow-right"></i>-->
<!--</a>-->
<!--</li>-->
<!--</ul>-->
<!--</li>-->

<!--<li class="green">-->
<!--<a data-toggle="dropdown" class="dropdown-toggle" href="#">-->
<!--<i class="icon-envelope icon-animated-vertical"></i>-->
<!--<span class="badge badge-success">5</span>-->
<!--</a>-->

<!--<ul class="pull-right dropdown-navbar dropdown-menu dropdown-caret dropdown-closer">-->
<!--<li class="nav-header">-->
<!--<i class="icon-envelope-alt"></i>-->
<!--5 Messages-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--<img src="assets/avatars/avatar.png" class="msg-photo" alt="Alex's Avatar" />-->
<!--<span class="msg-body">-->
<!--<span class="msg-title">-->
<!--<span class="blue">Alex:</span>-->
<!--Ciao sociis natoque penatibus et auctor ...-->
<!--</span>-->

<!--<span class="msg-time">-->
<!--<i class="icon-time"></i>-->
<!--<span>a moment ago</span>-->
<!--</span>-->
<!--</span>-->
<!--</a>-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--<img src="assets/avatars/avatar3.png" class="msg-photo" alt="Susan's Avatar" />-->
<!--<span class="msg-body">-->
<!--<span class="msg-title">-->
<!--<span class="blue">Susan:</span>-->
<!--Vestibulum id ligula porta felis euismod ...-->
<!--</span>-->

<!--<span class="msg-time">-->
<!--<i class="icon-time"></i>-->
<!--<span>20 minutes ago</span>-->
<!--</span>-->
<!--</span>-->
<!--</a>-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--<img src="assets/avatars/avatar4.png" class="msg-photo" alt="Bob's Avatar" />-->
<!--<span class="msg-body">-->
<!--<span class="msg-title">-->
<!--<span class="blue">Bob:</span>-->
<!--Nullam quis risus eget urna mollis ornare ...-->
<!--</span>-->

<!--<span class="msg-time">-->
<!--<i class="icon-time"></i>-->
<!--<span>3:15 pm</span>-->
<!--</span>-->
<!--</span>-->
<!--</a>-->
<!--</li>-->

<!--<li>-->
<!--<a href="#">-->
<!--See all messages-->
<!--<i class="icon-arrow-right"></i>-->
<!--</a>-->
<!--</li>-->
<!--</ul>-->
<!--</li>-->

<li class="light-blue">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">
        <!--<img class="nav-user-photo" src="assets/avatars/user.jpg" alt="Jason's Photo" />-->
								<span class="user-info">
									<small>Welcome,</small>
									Administrator
								</span>

        <i class="icon-caret-down"></i>
    </a>

    <ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-closer">
        <li>
            <a href="edit_user.html">
                <i class="icon-cog"></i>
                Edit Account
            </a>
        </li>

        <!--<li>-->
        <!--<a href="#">-->
        <!--<i class="icon-user"></i>-->
        <!--Profile-->
        <!--</a>-->
        <!--</li>-->

        <li class="divider"></li>

        <li>
            <!-- <a href="/d/user/sign_out"  rel="nofollow">Sign Out</a> -->
            <!--<a rel="nofollow"  href="/d/user/sign_out">Sign Out</a>-->
            <a href="login.html">
                <i class="icon-off"></i>
                Sign Out
            </a>
        </li>
    </ul>

</li>
</ul>
<!--/.ace-nav-->
</div>
<!--/.container-fluid-->
</div>
<!--/.navbar-inner-->
</div>

<div class="main-container container-fluid">
<a class="menu-toggler" id="menu-toggler" href="#">
    <span class="menu-text"></span>
</a>

<div id="sidebar" class="sidebar">
    <div id="sidebar-shortcuts" class="sidebar-shortcuts">

        <div id="sidebar-shortcuts-large" class="sidebar-shortcuts-large">
            <button class="btn invisible">
            </button>
            <!--<button class="btn btn-small btn-success">-->
            <!--<i class="icon-signal"></i>-->
            <!--</button>-->

            <!--<button class="btn btn-small btn-info">-->
            <!--<i class="icon-pencil"></i>-->
            <!--</button>-->

            <!--<button class="btn btn-small btn-warning">-->
            <!--<i class="icon-group"></i>-->
            <!--</button>-->

            <!--<button class="btn btn-small btn-danger">-->
            <!--<i class="icon-cogs"></i>-->
            <!--</button>-->
        </div>

        <div id="sidebar-shortcuts-mini" class="sidebar-shortcuts-mini">
            <span class="btn btn-success"></span>

            <span class="btn btn-info"></span>

            <span class="btn btn-warning"></span>

            <span class="btn btn-danger"></span>
        </div>
    </div>
    <!--#sidebar-shortcuts-->

    <ul class="nav nav-list">
        <li>
            <a href="list_users.html">
                <i class="icon-user"></i>
                <span class="menu-text"> User </span>
            </a>
        </li>


        <li class="">
            <a class="dropdown-toggle" href="#">
                <i class="icon-group"></i>
                <span class="menu-text"> Client </span>
                <b class="arrow icon-angle-down"></b>
            </a>
            <ul class="submenu" style="display: none;">
                <li>
                    <a href="new_client.html">
                        <i class="icon-double-angle-right"></i>
                        Add client
                    </a>
                </li>
                <li>
                    <a href="list_clients.html">
                        <i class="icon-double-angle-right"></i>
                        List clients
                    </a>
                </li>
                <!--<li>-->
                <!--<a href="#">-->
                <!--<i class="icon-double-angle-right"></i>-->
                <!--Add Note-->
                <!--</a>-->
                <!--</li>-->

                <li>
                    <a href="list_client_answers.html">
                        <i class="icon-double-angle-right"></i>
                        Client Answers
                    </a>
                </li>
            </ul>
        </li>

        <li>
            <a href="list_meetings.html">
                <i class="icon-calendar"></i>

							<span class="menu-text">
								Meeting
							</span>
            </a>
        </li>

        <li class="">
            <a class="dropdown-toggle" href="#">
                <i class="icon-file"></i>
                <span class="menu-text"> Schedule </span>

                <b class="arrow icon-angle-down"></b>
            </a>

            <ul class="submenu" style="display: none;">
                <li>
                    <a href="new_schedule.html">
                        <i class="icon-double-angle-right"></i>
                        Make Schedule
                    </a>
                </li>

                <li>
                    <a href="list_schedules.html">
                        <i class="icon-double-angle-right"></i>
                        List Schedules
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <a class="dropdown-toggle" href="#">
                <i class="icon-file"></i>
                <span class="menu-text"> Question </span>

                <b class="arrow icon-angle-down"></b>
            </a>

            <ul class="submenu">
                <li>
                    <a href="list_industries.html">
                        <i class="icon-double-angle-right"></i>
                        List Industry
                    </a>
                </li>

                <li>
                    <a href="list_questions.html">
                        <i class="icon-double-angle-right"></i>
                        List Question
                    </a>
                </li>
            </ul>
        </li>

        <li>
            <a href="#">
                <i class="icon-bar-chart"></i>
                <span class="menu-text"> Statistic </span>
            </a>
        </li>


        <li>
            <a href="introduction.html">
                <i class="icon-info"></i>
                <span class="menu-text"> Introduction </span>
            </a>
        </li>
        <li>
            <a href="about_us.html">
                <i class="icon-info"></i>
                <span class="menu-text"> About Us </span>
            </a>
        </li>
        <li>
            <a href="package_management.html">
                <i class="icon-dollar"></i>
                <span class="menu-text"> Package Payment </span>
            </a>
        </li>
        <li>
            <a href="contact_us.html">
                <i class="icon-pencil"></i>
                <span class="menu-text"> Contact Us </span>
            </a>
        </li>

    </ul>
    <!--/.nav-list-->

    <div id="sidebar-collapse" class="sidebar-collapse">
        <i class="icon-double-angle-left"></i>
    </div>
</div>

<div class="main-content">
    <div class="breadcrumbs" id="breadcrumbs">
        <ul class="breadcrumb">
            <li>
                <i class="icon-home home-icon"></i>
                <a href="#">Home</a>

							<span class="divider">
								<i class="icon-angle-right arrow-icon"></i>
							</span>
            </li>
            <li class="active">Users</li>
        </ul>
        <!--.breadcrumb-->

        <div class="nav-search" id="nav-search">
            <form class="form-search"/>
							<span class="input-icon">
								<input type="text" placeholder="Search ..." class="input-small nav-search-input"
                                       id="nav-search-input" autocomplete="off"/>
								<i class="icon-search nav-search-icon"></i>
							</span>
            </form>
        </div>
        <!--#nav-search-->
    </div>

    <div class="page-content">
        <div class="page-header position-relative">
            <h1>
                New Users
                <!--<small>-->
                <!--<i class="icon-double-angle-right"></i>-->
                <!--Static &amp; Dynamic Tables-->
                <!--</small>-->
            </h1>
        </div>
        <!--/.page-header-->

        <div class="row-fluid">
            <div class="span12">
                <!--PAGE CONTENT BEGINS-->

                <div class="row-fluid">
                    <div class="span12">
                        <div class="steps-wizard">
                            <div class="step1 step-active"></div>
                            <div class="step2"></div>
                            <div class="step3"></div>
                        </div>
                        <form  method="post" id="new_schedule" class="simple_form new_schedule" action="/schedules" accept-charset="UTF-8"><div style="margin:0;padding:0;display:inline"><input type="hidden" value="✓" name="utf8"><input type="hidden" value="pw/0JmZqO6r2uwEn4u7AR991qZ9XwFWVVGB+dihGu8o=" name="authenticity_token"></div>
                        <div class="steps-content">
                        <!-- STEP 1 -->
                            <div class="step1-content content-active">
                                <div class="control-group string required schedule_schedule_date"><label for="schedule_schedule_date" class="string required control-label"><abbr title="required">*</abbr> Schedule date</label><div class="controls"><input type="text" size="50" name="schedule[schedule_date]" id="schedule_schedule_date" data-date-format="dd-mm-yyyy" class="string required date-picker"></div></div>
                                <div class="row-fluid">
                                    <label for="schedule_start_time">Start Time</label>
                                </div>

                                <div class="control-group">
                                    <div class="input-append bootstrap-timepicker"><div class="bootstrap-timepicker-widget dropdown-menu"><table><tbody><tr><td><a data-action="incrementHour" href="#"><i class="icon-chevron-up"></i></a></td><td class="separator">&nbsp;</td><td><a data-action="incrementMinute" href="#"><i class="icon-chevron-up"></i></a></td></tr><tr><td><input type="text" maxlength="2" class="bootstrap-timepicker-hour" name="hour"></td> <td class="separator">:</td><td><input type="text" maxlength="2" class="bootstrap-timepicker-minute" name="minute"></td> </tr><tr><td><a data-action="decrementHour" href="#"><i class="icon-chevron-down"></i></a></td><td class="separator"></td><td><a data-action="decrementMinute" href="#"><i class="icon-chevron-down"></i></a></td></tr></tbody></table></div>
                                        <input type="text" name="schedule[start_time]" class="input-small" id="schedule_start_time">
															<span class="add-on">
																<i class="icon-time"></i>
															</span>
                                    </div>
                                </div>
                                <div class="row-fluid">
                                    <label for="schedule_end_time">End Time</label>
                                </div>

                                <div class="control-group">
                                    <div class="input-append bootstrap-timepicker"><div class="bootstrap-timepicker-widget dropdown-menu"><table><tbody><tr><td><a data-action="incrementHour" href="#"><i class="icon-chevron-up"></i></a></td><td class="separator">&nbsp;</td><td><a data-action="incrementMinute" href="#"><i class="icon-chevron-up"></i></a></td></tr><tr><td><input type="text" maxlength="2" class="bootstrap-timepicker-hour" name="hour"></td> <td class="separator">:</td><td><input type="text" maxlength="2" class="bootstrap-timepicker-minute" name="minute"></td> </tr><tr><td><a data-action="decrementHour" href="#"><i class="icon-chevron-down"></i></a></td><td class="separator"></td><td><a data-action="decrementMinute" href="#"><i class="icon-chevron-down"></i></a></td></tr></tbody></table></div>
                                        <input type="text" name="schedule[end_time]" class="input-small" id="schedule_end_time">
															<span class="add-on">
																<i class="icon-time"></i>
															</span>
                                    </div>
                                </div>

                                <div class="control-group integer required schedule_average_meeting_duration"><label for="schedule_average_meeting_duration" class="integer required control-label"><abbr title="required">*</abbr> Average meeting duration</label><div class="controls"><input type="number" step="1" name="schedule[average_meeting_duration]" id="schedule_average_meeting_duration" class="numeric integer required"></div></div>
                                <div class="control-group string optional schedule_transport"><label for="schedule_transport" class="string optional control-label">Transport</label><div class="controls"><input type="text" size="50" name="schedule[transport]" id="schedule_transport" class="string optional"></div></div>
                                <div class="control-group string required schedule_hq_location_id">
                                    <label for="schedule_hq_location_id" class="string required control-label">
                                        <abbr title="required">*</abbr> Hq location
                                    </label>
                                    <div class="controls">
                                        <input type="text" name="schedule[hq_location_id]" id="schedule_hq_location_id" class="string required"></div></div>
                                <div class="control-group string required schedule_ending_location_id">
                                    <label for="schedule_ending_location_id" class="string required control-label">
                                        <abbr title="required">*</abbr> Ending location</label>
                                    <div class="controls"><input type="text"  name="schedule[ending_location_id]" id="schedule_ending_location_id" class="string required"></div></div>
                                <a data-nav="next" class="navigation btn btn-primary" href="#">Choose Client</a>
                            </div>

                        <!-- STEP 2 -->
                        <div class="step2-content">
                            <h3>Choose potential clients</h3>

                            <!--<table class="table table-hover table-condensed">-->
                            <table class="table table-striped table-bordered table-hover" id="sample-table-1">
                                <thead>
                                <tr>
                                    <th class="center">
                                        <label>
                                            <input type="checkbox">
                                            <span class="lbl"></span>
                                        </label>
                                    </th>
                                    <th>Name</th>
                                    <th>Phone</th>
                                    <th>Email</th>
                                    <th>Country</th>
                                    <th>City</th>
                                    <th>Address</th>
                                    <th>Age</th>
                                    <th>Sex</th>
                                    <th>Create_By</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td class="center">
                                        <label>
                                            <input type="checkbox" value="11" name="clients[]" id="clients_">
                                            <span class="lbl"></span>
                                        </label>
                                    </td>
                                    <td>hai2sdfsd</td>
                                    <td>3254334543</td>
                                    <td>haitrh@test.com</td>
                                    <td></td>
                                    <td>Hue</td>
                                    <td>Hue, viet nam</td>
                                    <td>66</td>
                                    <td>1</td>
                                    <td>administrator</td>
                                </tr>
                                <tr>
                                    <td class="center">
                                        <label>
                                            <input type="checkbox" value="16" name="clients[]" id="clients_">
                                            <span class="lbl"></span>
                                        </label>
                                    </td>
                                    <td>sdfsd</td>
                                    <td>44545</td>
                                    <td>haitrh@test.com</td>
                                    <td>Austria</td>
                                    <td>Thanh Hoa</td>
                                    <td>Thanh Hoa, viet nam</td>
                                    <td>1</td>
                                    <td>1</td>
                                    <td>administrator</td>
                                </tr>
                                <tr>
                                    <td class="center">
                                        <label>
                                            <input type="checkbox" value="17" name="clients[]" id="clients_">
                                            <span class="lbl"></span>
                                        </label>
                                    </td>
                                    <td>sdf</td>
                                    <td>325433454</td>
                                    <td>haitrh@test.com</td>
                                    <td>Åland Islands</td>
                                    <td>Nghe An</td>
                                    <td>Nghe An, viet nam</td>
                                    <td>4</td>
                                    <td>1</td>
                                    <td>administrator</td>
                                </tr>
                                <tr>
                                    <td class="center">
                                        <label>
                                            <input type="checkbox" value="18" name="clients[]" id="clients_">
                                            <span class="lbl"></span>
                                        </label>
                                    </td>
                                    <td>Lam</td>
                                    <td>9843984</td>
                                    <td>haitrh@test.com</td>
                                    <td></td>
                                    <td>Da Nang</td>
                                    <td>Da Nang, viet nam</td>
                                    <td>66</td>
                                    <td>1</td>
                                    <td>administrator</td>
                                </tr>
                                <tr>
                                    <td class="center">
                                        <label>
                                            <input type="checkbox" value="19" name="clients[]" id="clients_">
                                            <span class="lbl"></span>
                                        </label>
                                    </td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>administrator</td>
                                </tr>
                                </tbody>
                            </table>
                            <br>
                            <!--[{"age":66,"city":"Hue","country":"","created_at":"2013-10-14T09:18:49Z","created_by":2,"email":"haitrh@test.com","id":11,"meeting_id":null,"name":"hai2sdfsd","organization_id":null,"phone":"3254334543","sex":1,"updated_at":"2013-10-21T09:01:38Z","location":{"address":"Hue, viet nam"}},{"age":1,"city":"Thanh Hoa","country":"Austria","created_at":"2013-10-17T06:49:57Z","created_by":2,"email":"haitrh@test.com","id":16,"meeting_id":null,"name":"sdfsd","organization_id":null,"phone":"44545","sex":1,"updated_at":"2013-10-21T09:02:06Z","location":{"address":"Thanh Hoa, viet nam"}},{"age":4,"city":"Nghe An","country":"Åland Islands","created_at":"2013-10-17T06:58:25Z","created_by":2,"email":"haitrh@test.com","id":17,"meeting_id":null,"name":"sdf","organization_id":null,"phone":"325433454","sex":1,"updated_at":"2013-10-21T09:02:31Z","location":{"address":"Nghe An, viet nam"}},{"age":66,"city":"Da Nang","country":"","created_at":"2013-10-17T06:59:47Z","created_by":2,"email":"haitrh@test.com","id":18,"meeting_id":null,"name":"Lam","organization_id":null,"phone":"9843984","sex":1,"updated_at":"2013-10-21T09:03:02Z","location":{"address":"Da Nang, viet nam"}},{"age":null,"city":null,"country":null,"created_at":"2013-10-29T07:27:36Z","created_by":2,"email":null,"id":19,"meeting_id":null,"name":null,"organization_id":null,"phone":null,"sex":null,"updated_at":"2013-10-29T07:27:36Z"}]-->

                            <a data-nav="next" class="navigation btn btn-primary" href="#">Generate direction</a>
                        </div>
                        <!-- STEP 3 -->
                        <div class="step3-content">
                            <div id="clientaddressdiv"></div>
                            <div style="width:800px;height:600px;" id="map-canvas"></div>
                            <div id="control_panel">
                                <!--<div style="margin:20px;border-width:2px;">-->
                                <!--<b>Start:</b>-->
                                <!--<select id="start">-->
                                <!--<option value="Ha Noi">Ha Noi</option>-->
                                <!--</select>-->
                                <!--<br>-->
                                <!--<b>Waypoints:</b> <br>-->
                                <!--<i>(Ctrl-Click for multiple selection)</i> <br>-->
                                <!--<select multiple id="waypoints">-->
                                <!--<option value="Ninh Binh">Ninh Binh</option>-->
                                <!--<option value="Thanh Hoa">Thanh Hoa</option>-->
                                <!--<option value="Nghe An">Nghe An</option>-->
                                <!--<option value="Hue">Hue</option>-->
                                <!--</select>-->
                                <!--<br>-->
                                <!--<b>End:</b>-->
                                <!--<select id="end">-->
                                <!--<option value="Da Nang">Da Nang</option>-->
                                <!--<option value="Ho Chi Minh">Ho Chi Minh</option>-->
                                <!--</select>-->
                                <!--<br>-->
                                <!--<input type="button" value="Get Way" onclick="calcRoute();">-->
                                <!--</div>-->
                                <div style="margin:20px;background-color:#FFEE77;" id="directions_panel"></div>
                            </div>
                            <!--<input type="submit" value="Create Schedule" name="commit" class="btn btn-primary">-->
                            <a class="btn btn-primary" href="list_schedules.html" id="createUserBtn">Create Schedule</a>
                        </div>
                        </div>
                        <!--<a href="#" class="navigation" data-nav="prev">Prev</a>&nbsp;&nbsp;<a href="#" class="navigation" data-nav="next">Next</a>-->
                        </form>


                    </div>
                    <!--/span-->
                </div>
                <!--/row-->

                <!--PAGE CONTENT ENDS-->
            </div>
            <!--/.span-->
        </div>
        <!--/.row-fluid-->
    </div>
    <!--/.page-content-->

    <div class="ace-settings-container" id="ace-settings-container">
        <div class="btn btn-app btn-mini btn-warning ace-settings-btn" id="ace-settings-btn">
            <i class="icon-cog bigger-150"></i>
        </div>

        <div class="ace-settings-box" id="ace-settings-box">
            <div>
                <div class="pull-left">
                    <select id="skin-colorpicker" class="hide">
                        <option data-class="default" value="#438EB9"/>
                        #438EB9
                        <option data-class="skin-1" value="#222A2D"/>
                        #222A2D
                        <option data-class="skin-2" value="#C6487E"/>
                        #C6487E
                        <option data-class="skin-3" value="#D0D0D0"/>
                        #D0D0D0
                    </select>
                </div>
                <span>&nbsp; Choose Skin</span>
            </div>

            <div>
                <input type="checkbox" class="ace-checkbox-2" id="ace-settings-header"/>
                <label class="lbl" for="ace-settings-header"> Fixed Header</label>
            </div>

            <div>
                <input type="checkbox" class="ace-checkbox-2" id="ace-settings-sidebar"/>
                <label class="lbl" for="ace-settings-sidebar"> Fixed Sidebar</label>
            </div>

            <div>
                <input type="checkbox" class="ace-checkbox-2" id="ace-settings-breadcrumbs"/>
                <label class="lbl" for="ace-settings-breadcrumbs"> Fixed Breadcrumbs</label>
            </div>

            <div>
                <input type="checkbox" class="ace-checkbox-2" id="ace-settings-rtl"/>
                <label class="lbl" for="ace-settings-rtl"> Right To Left (rtl)</label>
            </div>
        </div>
    </div>
    <!--/#ace-settings-container-->
</div>
<!--/.main-content-->
</div>
<!--/.main-container-->

<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-small btn-inverse">
    <i class="icon-double-angle-up icon-only bigger-110"></i>
</a>

<!--basic scripts-->

<!--[if !IE]>-->

<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<!--<![endif]-->

<!--[if IE]>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<![endif]-->

<!--[if !IE]>-->

<script type="text/javascript">
    window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>" + "<" + "/script>");
</script>

<!--<![endif]-->

<!--[if IE]>
<script type="text/javascript">
    window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>" + "<" + "/script>");
</script>
<![endif]-->

<script type="text/javascript">
    if ("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
</script>
<script src="assets/js/bootstrap.min.js"></script>

<!--page specific plugin scripts-->
<script src="assets/js/fuelux/fuelux.wizard.min.js"></script>
<script src="assets/js/jquery.validate.min.js"></script>
<script src="assets/js/additional-methods.min.js"></script>
<script src="assets/js/bootbox.min.js"></script>
<script src="assets/js/jquery.maskedinput.min.js"></script>
<script src="assets/js/select2.min.js"></script>
<script src="assets/js/jquery-ui-1.10.3.custom.min.js"></script>
<script src="assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="assets/js/chosen.jquery.min.js"></script>
<script src="assets/js/fuelux/fuelux.spinner.min.js"></script>
<script src="assets/js/date-time/bootstrap-datepicker.min.js"></script>
<script src="assets/js/date-time/bootstrap-timepicker.min.js"></script>
<script src="assets/js/date-time/moment.min.js"></script>
<script src="assets/js/date-time/daterangepicker.min.js"></script>
<script src="assets/js/bootstrap-colorpicker.min.js"></script>
<script src="assets/js/jquery.knob.min.js"></script>
<script src="assets/js/jquery.autosize-min.js"></script>
<script src="assets/js/jquery.inputlimiter.1.3.1.min.js"></script>
<script src="assets/js/jquery.maskedinput.min.js"></script>
<script src="assets/js/bootstrap-tag.min.js"></script>

<script src="assets/js/jquery.dataTables.min.js"></script>
<script src="assets/js/jquery.dataTables.bootstrap.js"></script>

<!--ace scripts-->

<script src="assets/js/ace-elements.min.js"></script>
<script src="assets/js/ace.min.js"></script>
<script src="assets/js/jquery_ujs.js"></script>
<!--inline scripts related to this page-->
<script>
    $(function() {

        $('#createUserBtn').click(function(event){
            if(!$('#new_schedule').valid()){
                event.preventDefault();
            }
        });

        $(".navigation").on("click",function(e){
            if(!$('#new_schedule').valid()){
                event.preventDefault();
            }
            e.preventDefault();
            var navigate = $(this).data("nav");
            if(navigate == "next"){
                count++;
            }else{
                count--;
            }

            if(count > totalPages){
                count = 0;
            }
            if(count < totalPages && count >=0){
                $pages.removeClass('content-active').eq(count).addClass('content-active');
                $steps.removeClass('step-active').eq(count).addClass('step-active');
            }

            if (count == 2){
                diffBetweenTwoTimes();

                initialize();
                $('input[name="clients[]"]:checked').each(function() {
//                clientListAddress.push(js_clients_array[this.value]['location']['address']);
                    clientListAddress.push(js_clients_array[this.value]);
                });

                calcRoute();
            }
        });

        //Update checkbox controls when click on checkbox all on Header
        $('table th input:checkbox').on('click', function () {
            var that = this;
            $(this).closest('table').find('tr > td:first-child input:checkbox')
                    .each(function () {
                        this.checked = that.checked;
                        $(this).closest('tr').toggleClass('selected');
                    });

        });


        //Add all clients to array to user later for collect which clients will be choose
        var js_clients_array = [];
        var js_clients_array_temp = [{"age":66,"city":"Hue","country":"","created_at":"2013-10-14T09:18:49Z","created_by":2,"email":"haitrh@test.com","id":11,"meeting_id":null,"name":"hai2sdfsd","organization_id":null,"phone":"3254334543","sex":1,"updated_at":"2013-10-21T09:01:38Z","location":{"address":"Hue, viet nam"}},{"age":1,"city":"Thanh Hoa","country":"Austria","created_at":"2013-10-17T06:49:57Z","created_by":2,"email":"haitrh@test.com","id":16,"meeting_id":null,"name":"sdfsd","organization_id":null,"phone":"44545","sex":1,"updated_at":"2013-10-21T09:02:06Z","location":{"address":"Thanh Hoa, viet nam"}},{"age":4,"city":"Nghe An","country":"Åland Islands","created_at":"2013-10-17T06:58:25Z","created_by":2,"email":"haitrh@test.com","id":17,"meeting_id":null,"name":"sdf","organization_id":null,"phone":"325433454","sex":1,"updated_at":"2013-10-21T09:02:31Z","location":{"address":"Nghe An, viet nam"}},{"age":66,"city":"Da Nang","country":"","created_at":"2013-10-17T06:59:47Z","created_by":2,"email":"haitrh@test.com","id":18,"meeting_id":null,"name":"Lam","organization_id":null,"phone":"9843984","sex":1,"updated_at":"2013-10-21T09:03:02Z","location":{"address":"Da Nang, viet nam"}},{"age":null,"city":null,"country":null,"created_at":"2013-10-29T07:27:36Z","created_by":2,"email":null,"id":19,"meeting_id":null,"name":null,"organization_id":null,"phone":null,"sex":null,"updated_at":"2013-10-29T07:27:36Z"}];

        for(var i=0;i < js_clients_array_temp.length;i++){
            js_clients_array[js_clients_array_temp[i].id] = js_clients_array_temp[i];
        }

        var $pages = $(".steps-content").children("div"),
                $steps = $(".steps-wizard").children("div"),
                totalPages = $pages.length,
                count = 0;


        //add clients model objects to javascript collection


//    $("input.datetimepicker").each(function(i) {
//        return $(this).datetimepicker({
//            dateFormat: "yy-mm-dd",
//            timeFormat: "hh:mm tt"
//        });
//    });
//    $("input.datepicker").each(function(i) {
//        return $(this).datepicker({
//            altFormat: "yy-mm-dd",
//            dateFormat: "mm/dd/yy",
//            altField: $(this).next()
//        });
//    })
// ;
//    $('.date-picker').datepicker({minDate:0}).next().on(ace.click_event, function(){
//        $(this).prev().focus();
//    });
        $('.date-picker').datepicker({
            startDate: "now",
            autoclose: true
        });

        $('#schedule_start_time').timepicker({
            minuteStep: 5,
            showSeconds: false,
            showMeridian: false
        });

        $('#schedule_end_time').timepicker({
            minuteStep: 5,
            showSeconds: false,
            showMeridian: false
        });



//        $('[data-rel=tooltip]').tooltip();

        //documentation : http://docs.jquery.com/Plugins/Validation/validate


        $.mask.definitions['~']='[+-]';
        $('#user_telephone').mask('(999) 999-9999');

        jQuery.validator.addMethod("phone", function (value, element) {
            return this.optional(element) || /^\(\d{3}\) \d{3}\-\d{4}( x\d{1,6})?$/.test(value);
        }, "Enter a valid phone number.");

        $('#new_schedule').validate({
            errorElement: 'span',
            errorClass: 'help-inline',
            focusInvalid: false ,
            rules: {
                "user[firstname]":{
                    required: true
                },
                "user[email]": {
                    required: true,
                    email:true
                },
                "user[password]": {
                    required: true,
                    minlength: 8
                },
                "user[password_confirmation]": {
                    required: true,
                    minlength: 8,
                    equalTo: "#user_password"
                },
                name: {
                    required: true
                },
                phone: {
                    required: true,
                    phone: 'required'
                }
            },

            messages: {
//                "user[firstname]":{
//                    required: "aaaaaaaaaaaaaaaaaaa"
//                },
                "user[email]": {
                    required: "Please provide a valid email.",
                    email: "is invalid"
                },
                password: {
                    required: "Please specify a password.",
                    minlength: "is too short (minimum is 8 characters)"
                }
            },
//
            invalidHandler: function (event, validator) { //display error alert on form submit
                $('.alert-error', $('.login-form')).show();
            },

            highlight: function (e) {
                $(e).closest('.control-group').removeClass('info').addClass('error');
            },

            success: function (e) {
                $(e).closest('.control-group').removeClass('error').addClass('info');
                $(e).remove();
            },

            errorPlacement: function (error, element) {
                if(element.is(':checkbox') || element.is(':radio')) {
                    var controls = element.closest('.controls');
                    if(controls.find(':checkbox,:radio').length > 1) controls.append(error);
                    else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));
                }
                else if(element.is('.select2')) {
                    error.insertAfter(element.siblings('[class*="select2-container"]:eq(0)'));
                }
                else if(element.is('.chzn-select')) {
                    error.insertAfter(element.siblings('[class*="chzn-container"]:eq(0)'));
                }
                else error.insertAfter(element);
            },

            submitHandler: function (form) {
            },
            invalidHandler: function (form) {
            }
        });
    });
</script>
</body>
</html>
